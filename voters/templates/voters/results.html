<div class="segment-slide" id="segment-{{ segment.segment_id }}">
    <h1>Results for {{ segment.name }}</h1>
    
    <!-- Show Winner Tab -->
    <button class="show-winner-btn" onclick="showWinner('{{ segment.segment_id }}')">Show Winner</button>

    <div class="winner-container" id="winner-container-{{ segment.segment_id }}" style="display: none;">
        <img id="winner-image-{{ segment.segment_id }}" src="" alt="Winner Image" class="winner-image" />
        <div id="winner-votes-{{ segment.segment_id }}" class="winner-votes"></div>
    </div>

    <div id="leaderboard-{{ segment.segment_id }}" class="leaderboard">
        {% for candidate in segment.candidates %}
        <div class="candidate_vote" id="candidate-{{ candidate.id }}">
            <span class="position" id="position-{{ candidate.id }}"></span>:
            <span class="name">{{ candidate.name }}</span> - 
            <span class="votes" id="votes-{{ candidate.id }}">0</span>
        </div>
        {% endfor %}
    </div>

    <div class="chart-container">
        <canvas id="chart-{{ segment.segment_id }}"></canvas>
    </div>
</div>
<script>

function showWinner(segmentId) {
    const segmentData = voteData.find(segment => segment.segment_id === segmentId);
    const winner = segmentData.candidates.reduce((max, candidate) => 
        (candidate.votes > max.votes ? candidate : max), segmentData.candidates[0]);

    // Display winner's image and votes
    const winnerImage = document.getElementById(`winner-image-${segmentId}`);
    const winnerVotes = document.getElementById(`winner-votes-${segmentId}`);
    const winnerContainer = document.getElementById(`winner-container-${segmentId}`);

    winnerImage.src = winner.image_url;  // Assume each candidate has an image_url field
    winnerVotes.textContent = `Votes: ${winner.votes}`;
    
    // Show the winner container
    winnerContainer.style.display = "block";

    // Apply bouncing and zoom effect
    winnerImage.classList.add('bouncing');
    gsap.to(winnerImage, { scale: 1.2, duration: 1, yoyo: true, repeat: -1 });

    // Trigger confetti animation
    confetti({
        particleCount: 100,
        spread: 60,
        origin: { x: 0.5, y: 0.5 },
        colors: ['#ff0000', '#00ff00', '#0000ff'],
        disableForReducedMotion: true
    });
}

// Confetti function using canvas-confetti
function confetti(options) {
    const confettiCanvas = document.createElement('canvas');
    document.body.appendChild(confettiCanvas);
    confettiCanvas.classList.add('confetti-canvas');

    const ctx = confettiCanvas.getContext('2d');
    const { width, height } = window.innerWidth;
    confettiCanvas.width = width;
    confettiCanvas.height = height;

    const particleCount = options.particleCount || 100;
    const spread = options.spread || 60;
    const colors = options.colors || ['#ff0000', '#00ff00', '#0000ff'];

    // Generate particles
    for (let i = 0; i < particleCount; i++) {
        const x = Math.random() * width;
        const y = Math.random() * height;
        const color = colors[Math.floor(Math.random() * colors.length)];
        ctx.beginPath();
        ctx.arc(x, y, 5, 0, 2 * Math.PI);
        ctx.fillStyle = color;
        ctx.fill();
    }

    setTimeout(() => {
        document.body.removeChild(confettiCanvas);
    }, 3000);  // Remove canvas after 3 seconds
}

</script>